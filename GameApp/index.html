<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>Layou</title>
    <script src="js/mui.min.js"></script>
	<script src="js/mui.enterfocus.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/ui.css" />
    <script src="../js/frame/template-web.js"></script>
</head>
<body>
	<nav class="mui-bar mui-bar-tab my-bar-tab" id="bottom-navigation">
	    <a class="mui-tab-item mui-active" tabindex="0">
	        <span class="mui-icon mui-icon-location"></span>
	        <span class="mui-tab-label">首页</span>
	    </a>
	    <a class="mui-tab-item" tabindex="1">
	        <span class="mui-icon mui-icon-flag"></span>
	        <span class="mui-tab-label">代理后台</span>
	    </a>
	    <a class="mui-tab-item" tabindex="2" id="roomTab">
	        <span class="mui-icon mui-icon-home"></span>
	        <span class="mui-tab-label">游戏房间</span>
	    </a>
	    <a class="mui-tab-item" tabindex="3">
	        <span class="mui-icon mui-icon-contact"></span>
	        <span class="mui-tab-label">个人中心</span>
	    </a>
	</nav>
	
	<script src="js/config.js"></script>
	<script src="js/app.js"></script> 
	
	<script type="text/javascript"> 
		var gDoc;
		var pages = window.config.pages;
		   
		(function($, doc) {
			gDoc = doc;
			
			$.init({
				statusBarStyle: "light",
				statusBarBackground: '#fe5a2f'
			});
			
			window.config.doc = doc;
			
			$.plusReady(function() {
				// 设置顶部状态栏样式
				plus.navigator.setStatusBarStyle("light");
				plus.navigator.setStatusBarBackground("#FE532A");
				
				// 禁止屏幕翻转
				plus.screen.lockOrientation("portrait-primary");
				 
				
				// 系统回退键监听
				$.oldBack = mui.back;
				var backButtonPress = 0;
				$.back = function(event) {
					plus.navigator.setStatusBarBackground("#FE532A");
					
					backButtonPress++;
					if (backButtonPress > 1) {
						plus.runtime.quit();
					} else {
						plus.nativeUI.toast('再按一次退出应用');
					}
					setTimeout(function() {
						backButtonPress = 0;
					}, 1000);
					return false;
				};
				 
				 
				 
				// 监听网络状态变化
				netChangeSwitch();
				 
				// 初始化webView列表
				var currentWebView = plus.webview.currentWebview();
				// 动态创建webView对象
				for (var i = 0; i < pages.length; i++) {
					var page = plus.webview.create(pages[i].url
						,pages[i].id
						,pages[i].style);
					page.hide();
					// 为每个选项卡注册show事件
		            plus.webview.getWebviewById(pages[i].id).addEventListener('show',showCallback.bind(page, pages[i].id)); 
					currentWebView.append(page);
				}
				plus.webview.show(pages[0].id);
				
				// 注册TAB触摸事件
				mui(".mui-bar-tab").on("tap", "a", function(e){
					var tabindex = this.getAttribute("tabindex");
					plus.nativeUI.closeWaiting();
					plus.webview.show(pages[tabindex].id, "fade-in", 200);
					for (var i = 0 ; i < pages.length ; i ++) {
						if (i != tabindex) { 
							plus.webview.hide(pages[i].id, "fade-out", 200);
						}
					} 
				}) 
				
				 
			});
		}(mui, document));
		
		
		/**
		 * 监听网络状态变化 韦德 2018年8月22日20:49:37
		 */
		function netChangeSwitch(){
			document.addEventListener("netchange", function(){
				// 网络状态变化判断
				var connectionState = plus.networkinfo.getCurrentType();
				if(connectionState != 0 && connectionState != 1){
					// 重新打开网络连接
					

				}else{
					// 关闭网络连接
					mui.alert("请打开网络连接");
				}
			})
		}
		
		
		/**
		 * 初始化所有的webView 韦德 2018年8月12日18:05:38
		 */
		function initWebViewList(){
			var defaultStyle = {
				top: "44px",
				bottom: "50px"
			}
			var currentWebView = plus.webview.currentWebview();
			// 动态创建webView对象
			for (var i = 0; i < pages.length; i++) {
				var page = plus.webview.create(pages[i].url
					,pages[i].id
					,defaultStyle)
				page.hide();
				currentWebView.append(page);
			}
			plus.webview.show(pages[0].id);
		}
		
		/**
		 * 显示指定的webView 韦德 2018年8月12日18:05:12
		 * @param {Object} tabindex
		 */
		function showWebView(tabindex){
			plus.webview.show(pages[tabindex].id, "fade-in", 200);
			hideOtherWebView(tabindex);
		}
		
		/**
		 * 隐藏非焦点webView 韦德 2018年8月12日18:05:23
		 * @param {Object} tabindex
		 */
		function hideOtherWebView(tabindex){
			for (var i = 0 ; i < pages.length ; i ++) {
					if (i != tabindex) {
						plus.webview.hide(pages[i].pageId, "fade-out", 200);
					}
			}
		}
		
		/**
		 * 跳转登录页
		 * @param {Object} $
		 */
		function toLogin($){
			$.openWindow({
				url: 'login.html',
				id: 'login',
				preload: true,
				show: {
					aniShow: 'pop-in',
					duration: 200
				},
				styles: {
					popGesture: 'hide'
				},
				waiting: {
					title: "正在加载...",
					autoShow: true
				}
			});
		}
		
		/**
		 * webView的show回调事件
		 * @param {Object} id
		 */
		function showCallback(id){
			if(id == "room"){
				app.toBar(2, gDoc);
			}else if(id == "my"){
				app.toBar(3, gDoc);
			}else if(id == "merchantBusinessList"){
				app.toBar(1, gDoc);
			}else if(id == "home"){
				app.toBar(0, gDoc);
			}
		}
	</script>
</body>
</html>