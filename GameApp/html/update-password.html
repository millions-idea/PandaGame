<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/ui.css" rel="stylesheet" />
		<link href="../css/update-password.css" rel="stylesheet" /> 
	</head>

	<body>
		<header class="mui-bar mui-bar-nav my-title">
			<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title my-title-color">修改密码</h1>
		</header>
		
		
		
		<div class="mui-content">
		 	<div class="form-placeholder-10"></div>
		 	<div class="form-placeholder-5"></div>
			
			
			<!--password begin-->
			<div class="form-item form-item-full">
				<input type="text" class="form-input" id="password" maxlength="16" placeholder="请输入原始密码" value=""/>
			</div>
			<!--password end-->
			
			
			<!--password begin-->
			<div class="form-item form-item-full">
				<input type="text" class="form-input" id="newPassword" maxlength="16" placeholder="请输入新密码" value=""/>
			</div>
			<!--password end-->
			
			
			<!--login button begin-->
			<div class="form-placeholder-20"></div>
			<div class="form-item">
				<button id='editButton' class="mui-btn mui-btn-block mui-btn-orange">修&nbsp;&nbsp;改</button>
			</div>
			<!--login button end-->
		</div>
		
		
		<script src="../js/mui.min.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/my/index.js"></script>
		<script type="text/javascript">
			
			(function($, doc){
				$.init({
					statusBarStyle: "light",
					statusBarBackground: '#fe5a2f'
				});
				
				$.plusReady(function(){
					// 设置顶部状态栏样式
					plus.navigator.setStatusBarStyle("light");
					plus.navigator.setStatusBarBackground("#FE532A");
					
					// 禁止屏幕翻转
					plus.screen.lockOrientation("portrait-primary");
					
					
					
					var editButton = doc.getElementById("editButton"),
						passwordInput = doc.getElementById("password"),
						newPasswordInput = doc.getElementById("newPassword");
						
					editButton.addEventListener("tap", function(){
						
						var localCache = plus.storage.getItem('userInfo');
						
						editButton.disabled = true;
						editButton.classList.add("disabled");
						
						my.editPassword({
							token: JSON.parse(localCache).token.toString(),
							password: passwordInput.value,
							newPassword: newPasswordInput.value
						}, function(data){
							editButton.disabled = false;
							editButton.classList.remove("disabled");
							
							if(data.code == 500 || data.code == 300){
								plus.nativeUI.toast("修改失败"); 
								return false;
							}
							
							if(data.code == 400){ 
								plus.nativeUI.toast(data.msg);
								return false;
							}
							
							plus.nativeUI.toast("修改成功"); 
							var localCache = plus.storage.getItem('userInfo');
							if(localCache != null && localCache.length > 0){ 
								app.logout({
									"token": JSON.parse(localCache).token.toString()
								}, function(data){
									toLogin($);
								}, function(){
									toLogin($);
								})
							}else{
								toLogin($);
							}
						})
					}, false);
					
				});

			})(mui, document)
			 
			
			/**
			 * 跳转登录页
			 * @param {Object} $
			 */
			function toLogin($){
				plus.storage.setItem('userInfo','');
				plus.storage.setItem('isAutoLogin','false');
				$.openWindow({
					url: '/login.html',
					id: 'login',
					preload: true,
					show: {
						aniShow: 'pop-in',
						duration: 200
					},
					styles: {
						popGesture: 'hide'
					},
					waiting: {
						title: "正在加载...",
						autoShow: true
					}
				});
			}
		</script>
	</body>

</html>