<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/ui.css" rel="stylesheet" />
		<link href="../css/room/closeAccounts.css" rel="stylesheet" />
		
	</head>

	<body>
		<header class="mui-bar mui-bar-nav my-title" >
			<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title my-title-color" id="title">结算</h1>
		</header>
		
		<div class="mui-content">
		 	<div class="form-placeholder-50"></div>
			
			
			<!--password begin-->
			<div class="form-item form-item-full">
				<input type="text" class="form-input" id="standings" maxlength="16" placeholder="请输入战绩" value="632"/>
			</div>
			<!--password end-->
			
			

			<div class="form-item form-item-full">
				<input type="text" class="form-input" id="beRouted" maxlength="16" placeholder="请输入败绩" value="556"/>
			</div>

			
			
			<div class="form-placeholder-20"></div>
			<div class="form-item">
				<button id='toCloseAccountsButton' class="mui-btn mui-btn-block mui-btn-orange">结&nbsp;&nbsp;算</button>
			</div>

		</div>
		
		
		<script src="../js/mui.min.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/app.js"></script> 
		<script src="../js/room/index.js"></script> 
		<script type="text/javascript">
			
			(function($, doc){
				$.init({
					statusBarStyle: "light",
					statusBarBackground: '#fe5a2f'
				});
				
				$.plusReady(function(){
					// 设置顶部状态栏样式
					plus.navigator.setStatusBarStyle("light");
					plus.navigator.setStatusBarBackground("#FE532A");
					
					// 禁止屏幕翻转
					plus.screen.lockOrientation("portrait-primary");
					
					var self = plus.webview.currentWebview();
					var roomCode = self.room_code;
					
					var toCloseAccountsButton = doc.getElementById("toCloseAccountsButton"),
						standings = doc.getElementById("standings"),
						beRouted = doc.getElementById("beRouted");
						
					toCloseAccountsButton.addEventListener("tap", function(){
						console.log("申请结算")
						var localCache = plus.storage.getItem('userInfo');
						if(localCache != null && localCache.length > 0){
							var param = {
								"token": JSON.parse(localCache).token.toString(),
								"roomCode": parseInt(roomCode),
								"standings": parseFloat(standings.value),
								"beRouted": parseFloat(beRouted.value)
							};
							
							console.log(JSON.stringify(param));
							
							room.closeAccounts(param, function(data){
								if(data.code == 500 || data.code == 300){
									plus.nativeUI.toast("申请失败"); 
									return false;
								}
								
								if(data.code == 400){ 
									if(data.msg == "已存在") data.msg = "请不要重复申请";
									plus.nativeUI.toast(data.msg);
									return false;
								}
								
								plus.nativeUI.toast("申请成功");
								self.close;
							}, function(){
								plus.nativeUI.toast("申请失败");
							});
						}
						
					})
				});

			})(mui, document)
			 
			  
		</script>
	</body>

</html>