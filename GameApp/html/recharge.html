<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/ui.css" rel="stylesheet" />
		<link href="../css/room/closeAccounts.css" rel="stylesheet" />
		
	</head>

	<body>
		<header class="mui-bar mui-bar-nav my-title" >
			<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title my-title-color" id="title">充值中心</h1>
		</header>
		
		<div class="mui-content">
		 	<div class="form-placeholder-50"></div>
			

			<div class="form-item form-item-full">
				<input type="number" class="form-input" id="amount" maxlength="16" placeholder="请输入充值金额" value=""/>
			</div>
			
			
			<div class="form-placeholder-20"></div>
			<div class="form-item">
				<button id='rechargeButton' class="mui-btn mui-btn-block mui-btn-orange">模拟充值</button>
			</div>

		</div>
		
		
		<script src="../js/mui.min.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/app.js"></script> 
		<script src="../js/home/index.js"></script> 
		<script type="text/javascript">
			var pages = window.config.pages;
			 
			(function($, doc){
				$.init({
					statusBarStyle: "light",
					statusBarBackground: '#fe5a2f'
				});
				
				$.plusReady(function(){
					// 设置顶部状态栏样式
					plus.navigator.setStatusBarStyle("light");
					plus.navigator.setStatusBarBackground("#FE532A");
					
					// 禁止屏幕翻转
					plus.screen.lockOrientation("portrait-primary");
					
					var self = plus.webview.currentWebview();
					var beforeSelf = self.self;
					var roomCode = self.room_code;
					 
					var rechargeButton = doc.getElementById("rechargeButton"),
						amountInput = doc.getElementById("amount");
						
					rechargeButton.addEventListener("tap", function(){
						var localCache = plus.storage.getItem('userInfo');
						if(localCache != null && localCache.length > 0){
							var param = {
								"token": JSON.parse(localCache).token.toString(),
								"amount": parseFloat(amountInput.value) 
							};
							
							home.recharge(param, function(data){
								if(data.code == 500 || data.code == 300){
									plus.nativeUI.toast("充值失败"); 
									return false;
								}
								
								if(data.code == 400){ 
									plus.nativeUI.toast(data.msg);
									return false;
								}
								
								plus.nativeUI.toast("充值成功");
								
								$.openWindow({
									url: 'my.html',
									id: 'my',
									preload: true,
									show: {
										aniShow: 'pop-in',
										duration: 200
									},
									styles: {
										popGesture: 'hide'
									},
									waiting: {
										title: "正在加载...",
										autoShow: true
									}
								});
								
								for (var i = 0 ; i < pages.length ; i ++) {
									if (i != 3) { 
										plus.webview.hide(pages[i].id, "fade-out", 200);
									}
								}
								
								plus.webview.currentWebview().close();
								
							}, function(){
								plus.nativeUI.toast("充值失败");
							});
						}
						
					})
				});

			})(mui, document)
			 
			  
		</script>
	</body>

</html>