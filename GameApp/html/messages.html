<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link href="../css/ui.css" rel="stylesheet" />
		<link href="../css/my/index.css" rel="stylesheet" />
		<script src="../js/frame/template-web.js"></script>
		
	</head>

	<body style="background-color: #efeff4">
		<header class="mui-bar mui-bar-nav my-title">
			<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title my-title-color">短消息</h1>
		</header>
		<div class="form-placeholder-30"></div>
		<div class="mui-content content" id="content" >
			<span class="loading" id="loading-text">请稍后……</span>
			<script id="template" type="text/html">
				<ul class="mui-table-view">
				    {{each list as item index}}
						<li class="mui-table-view-cell mui-media" style="line-height: 30px;">
					        <a href="javascript:;">
					            <div class="mui-media-body">
					                {{item.addTime}}
					                <p class='mui-ellipsis'>{{item.message}}</p>
					            </div>
					        </a>
					    </li>
					{{/each}}
				</ul>
			</script>
		</div>
		
		<script src="../js/mui.min.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/app.js"></script>
		
		<script type="text/javascript">
			(function($, doc) {
				
				$.init({
					statusBarStyle: "light",
					statusBarBackground: '#fe5a2f'
				});
				
				$.plusReady(function(){
					// 设置顶部状态栏样式
					plus.navigator.setStatusBarStyle("light");
					plus.navigator.setStatusBarBackground("#FE532A");
					
					// 禁止屏幕翻转
					plus.screen.lockOrientation("portrait-primary");
					

					plus.webview.currentWebview().addEventListener("show", function(){
						var localCache = plus.storage.getItem('userInfo');
						if(!(localCache != null && localCache.length > 0)) return false; 
						app.getMessageList({
							"token": JSON.parse(localCache).token.toString()
						}, function(data){
							if(data == null || data.code == null || data.code == 500 || data.code == 300) return plus.nativeUI.toast("加载失败");
							if(data.code == 400) return plus.nativeUI.toast("加载失败");
							
							for (var i = 0; i < data.data.length; i++) {
								data.data[i].addTime = timestampConvert(data.data[i].addTime);
							}
							
							var html = template("template", {
								list: data.data
							});
							
							if(data.data.length == 0) {
								doc.getElementById("loading-text").innerText = "暂时没有短消息";
								return;
							}
					
							doc.getElementById("content").innerHTML = html;
						}, function(){});
					})
				});
				
				
				
			}(mui, document));
			 
			 
			function timestampConvert (ts) {
		        var date = new Date(ts);
		        Y = date.getFullYear() + '-';
		        M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
		        D = date.getDate() + ' ';
		        h = date.getHours() + ':';
		        m = date.getMinutes() + ':';
		        s = date.getSeconds();
		        return Y+M+D+h+m+s;
		    }
		</script>
	</body>

</html>