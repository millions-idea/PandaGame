<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../css/ui.css" />
		<link rel="stylesheet" href="../css/home/index.css" />
		<script src="../js/frame/template-web.js"></script>
		
	</head>

	<body>	
		<header class="mui-bar mui-bar-nav my-title">
			<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title my-title-color">创建房间</h1>
		</header>
		
		
		<div class="mui-content" id="refreshContainer">
		 	<div class="form-placeholder-5"></div>
			
			<div class="container">
				<ul id="subareas" class="subareas">
					    <span class="mui-icon mui-icon-spinner mui-spin loading"></span>
						<span class="loading">系统正在加载,请稍后……</span>
				</ul>
				<script id="subareasTemplate" type="text/html">
					{{each list as item index}}
					    <li name="create-room-item" data-id="{{item.subareaId}}">
							<img src="{{item.backgroundImage}}" alt="{{item.name}}" />
						</li>
					{{/each}}
				</script>
				<!--subareas end-->
			</div>
				
		</div>
		    
	    <!--bottom navigation begin-->
		<div class="bottom-navigation-style"></div>
	    <!--bottom navigation end-->
		</div>
		
		
		<script src="../js/mui.js"></script>
		<script src="../js/config.js"></script>
		<script src="../js/app.js"></script>
		<script src="../js/wss.js"></script>
		<script src="../js/home/index.js"></script>
		<script src="../js/room/index.js"></script>

		<script type="text/javascript">
			var gDoc;
			var pages = window.config.pages;
			
			(function($, doc){
				gDoc = doc;  
				
				$.plusReady(function(){
					// 设置顶部状态栏样式
					plus.navigator.setStatusBarStyle("light");
					plus.navigator.setStatusBarBackground("#FE532A");
					
					// 禁止屏幕翻转
					plus.screen.lockOrientation("portrait-primary"); 
					 
					
					var self = plus.webview.currentWebview();
	                var subareaId = self.subareaId;
	                 
	                 
	                console.log("subareaId: " + subareaId)
				
					// 获取房间类型
					home.getSubareas({
						subareaId: subareaId
					}, function(data){
						if(data == null || data.code != 200) return plus.nativeUI.toast("加载列表失败");
							 	
						var html = template("subareasTemplate", {
							list: data.data
						}); 
						doc.getElementById("subareas").innerHTML = html;
						
						
		                 //关闭等待框
		                plus.nativeUI.closeWaiting();
		                //显示当前页面
		                mui.currentWebview.show();
		                
		                // 创建房间
		                var items = doc.getElementsByName("create-room-item");
		                for (var i = 0; i < items.length; i++) {
		                	items[i].addEventListener("tap", function(data){  
		                		var itemId = this.getAttribute("data-id");
		                		var parentAreaId = subareaId;
		                		
		                		 mui.openWindow({
						            url: "new-room.html",
						            id: "new-room",
						            preload: false,
						            show: {
										aniShow: 'pop-in',
										duration: 200
									},
									styles: {
										popGesture: 'hide'
									},
									waiting: {
										title: "正在加载...",
										autoShow: true
									},
									extras:{
										"parentAreaId": parentAreaId,
										"subareaId": itemId
								    }
						        }); 
								

		                	})
		                }
		                
					}, function(){
						plus.nativeUI.toast("加载列表失败");
						
		                 //关闭等待框
		                plus.nativeUI.closeWaiting();
		                //显示当前页面
		                mui.currentWebview.show();
						
					});
	                
	                
	               
	                
				})
				
			})(mui, document);
			 
		</script>
		 
	</body>

</html>