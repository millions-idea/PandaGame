<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/mui.poppicker.css" rel="stylesheet" />
		<link href="../../css/ui.css" rel="stylesheet" />
		<link href="../../css/room/index.css" rel="stylesheet" />
		<link href="../../css/sala/index.css" rel="stylesheet" />
		<link href="../../css/v2/roomList.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/ui.css" />
		<link rel="stylesheet" href="../../css/home/index.css" />
		<link rel="stylesheet" href="../../css/v2/home.css" />
		<script src="../../js/frame/template-web.js"></script>
		
	</head>

	<body>
		<header class="mui-bar mui-bar-nav my-title">
			<a class="mui-action-back mui-icon mui-icon-arrowleft mui-pull-left" style="color: #fff;"></a>
			<h1 class="mui-title my-title-color">创建拼桌房间</h1>
		</header>
		
		
		<div class="mui-content" id="refreshContainer">
		 	<div class="form-placeholder-5"></div>
			
			<!--subareas begin-->
				<ul id="subareas" class="subareas"></ul>
				<script id="subareasTemplate" type="text/html">
					<li id="downloadApp">
						<img src="../../images/subareas/download.png"/>
					</li>
					{{each list as item index}}
						<li name="subareas-item" data-id="{{item.subareaId}}" data-state="{{item.isEnable}}">
							<img src="../{{item.backgroundImage}}"  alt="{{item.name}}" />
						</li>
					{{/each}} 
				</script>
				<!--subareas end--> 
		</div>
		    
		
		
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/config.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/home/index.js"></script>
		<script src="../../js/room/index.js"></script>
		<script src="../../js/wss.js"></script>
		
		<script type="text/javascript">
			var gDoc;
			var pages = window.config.pages;
			
			(function($, doc){
				gDoc = doc;
				
				$.init({
					beforeback: function(){
					  	plus.navigator.setStatusBarBackground("#c9975c");
						return true;
				  	}
				});
				
				$.plusReady(function(){
					// 设置顶部状态栏样式
					plus.navigator.setStatusBarStyle("light");
					plus.navigator.setStatusBarBackground("#fe5a2f");
					
					// 禁止屏幕翻转
					plus.screen.lockOrientation("portrait-primary");
					
					home.getLevelSubareas({}, function(data){
						if(data == null || data.code != 200 || data.count == 0) return plus.nativeUI.toast("服务器开小差了,请您稍后重试!");
						var html = template("subareasTemplate", {
							list: data.data
						});
						gDoc.getElementById("subareas").innerHTML = html;
						
						
						// 打开下载熊猫麻将app地址
						gDoc.getElementById("downloadApp").addEventListener("tap", function(){
							//http://android.myapp.com/myapp/detail.htm?apkName=com.mahjong.sichuang&ADTAG=mobile
							plus.runtime.openURL("http://android.myapp.com/myapp/detail.htm?apkName=com.mahjong.sichuang&ADTAG=mobile");
						})
						
						// 创建房间事件
						var items = gDoc.getElementsByName("subareas-item");
						
						for (var i = 0; i < items.length; i++) {
							items[i].addEventListener("tap", function(){
								var id = this.getAttribute("data-id");
								var state = this.getAttribute("data-state");
								if(state == 0) return plus.nativeUI.toast("此游戏区暂未对外开放");
								mui.openWindow({
				                    url: "/html/create-room.html",
				                    id: "create-room",
				                    preload: false,
				                    waiting: {
				                        autoShow: true,
				                      title:'正在加载...'
				                    },
				                    extras:{
										subareaId: id
								    },
								    createNew:true
				    
				                });
							})
						}
						
						
					},function(){
						plus.nativeUI.toast("服务器开小差了,请您稍后重试!");
					});
					
					
				})
				
			})(mui, document);
			
		</script>
	</body>

</html>